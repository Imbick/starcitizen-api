
namespace Imbick.StarCitizen.Api.Tests {
    using System.Linq;
    using System.Net;
    using System.Threading.Tasks;
    using Api.Models;
    using Xunit;
    using Moq;
    using RestSharp;

    public class GetOrgMembersTests {

        [Fact]
        public async Task ListOrgMembersAsync_Always_ReturnsCorrectResultsAsync() {
            var response = new RestResponse<Response> {
                Data = _dummyResponse_9Members,
                StatusCode = HttpStatusCode.OK,
                ResponseStatus = ResponseStatus.Completed
            };
            _mockRest.Setup(r => r.ExecutePostTaskAsync<Response>(It.IsAny<IRestRequest>()))
                .Returns(Task.FromResult<IRestResponse<Response>>(response));
            var client = new RsiApiClient(_mockRest.Object);

            var orgMembers = await client.ListOrgMembersAsync("SWISS");

            Assert.Equal(9, orgMembers.Count());
        }

        [Fact]
        public async Task GetOrgMembersAsync_WithSearchTerm_ReturnsCorrectResultAsync() {
            var response = new RestResponse<Response> {
                Data = _dummyResponse_1Member,
                StatusCode = HttpStatusCode.OK,
                ResponseStatus = ResponseStatus.Completed
            };
            _mockRest.Setup(c => c.ExecutePostTaskAsync<Response>(It.IsAny<IRestRequest>()))
                .Returns(Task.FromResult<IRestResponse<Response>>(response));
            var client = new RsiApiClient(_mockRest.Object);
            var searchRequest = new OrgMembersSearchRequest { Symbol = "SWISS", Search = "meetsch" };
            var orgMembers = await client.GetOrgMembersAsync(searchRequest);

            Assert.Equal(1, orgMembers.Count());
            Assert.Equal(_dummyOrgMember, orgMembers.First());
        }

        private readonly OrgMember _dummyOrgMember = new OrgMember
        {
            Name = "Meetsch",
            Handle = "meetsch",
            AvatarUrl = "/media/80d4lybcin5dhr/avatar/Swiss-Starships-Ecusson.png"
        };

        private readonly Response _dummyResponse_1Member = new Response
        {
            Data = new ResponseData
            {
                Html = @"\t<li class=\""member-item js-member-item org-main org-visibility-V\"" data-org-sid=\""SWISS\"" data-org-name=\""Swiss Starships\"">\n\t\t<a class=\""membercard js-edit-member\""  href=\""/citizens/meetsch\"">\n      <span class=\""thumb\"">\n        \t\t\t\t<img src=\""/media/80d4lybcin5dhr/avatar/Swiss-Starships-Ecusson.png\"" />\n                <div class=\""corner corner-top-left\""></div>\n        <div class=\""corner corner-top-right\""></div>\n        <div class=\""corner corner-bottom-left\""></div>\n        <div class=\""corner corner-bottom-right\""></div>\n\t\t\t</span>\n\t\t\t<span class=\""right\"">\n        \t\t\t\t<span class=\""abs-overlay trans-03s roles\"">\n          \t\t\t\t\t<span class=\""title\"">Roles</span>\n\t\t\t\t\t<ul class=\""rolelist\"">\n\t\t\t\t\t\t\t\t\t\t\t</ul>\n          \t\t\t\t</span>\n                \n                                                \n\t\t\t\t<span class=\""trans-03s frontinfo\"">\n\t\t\t\t\t<span class=\""name-wrap\"">\n\t\t\t\t\t\t<span class=\""trans-03s name data3\"">Meetsch</span>\n\t\t\t\t\t\t<span class=\""trans-03s nick data1\"">meetsch</span>\n            <div class=\""wrap-border-line left\""></div>\n            <div class=\""wrap-border-line right\""></div>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class=\""ranking-stars data4\"">\n            \t\t\t\t\t\t<span class=\""stars\"" style=\""width: 40%;\""></span>\n            \t\t\t\t\t</span>\n\t\t\t\t\t          <span class=\""rank\"">Recrue</span>\n          \t\t\t\t\t\t\t\t\t</span>\n\t\t\t</span>\n\t\t</a>\n    \t\t    <div class=\""corner corner-top-left\""></div>\n    <div class=\""corner corner-top-right\""></div>\n    <div class=\""corner corner-bottom-left\""></div>\n    <div class=\""corner corner-bottom-right\""></div>\n\t</li>\n"
            }
        };

        private readonly Response _dummyResponse_9Members = new Response {
            Data = new ResponseData {
                Html = @"\t <li class=\""member-item js-member-item org-main org-visibility-V\"" data-org-sid=\""SWISS\"" data-org-name=\""Swiss Starships\"">\n\t\t<a class=\""membercard js-edit-member\""  href=\""/citizens/Maark\"">\n      <span class=\""thumb\"">\n        \t\t\t\t<img src=\""/media/j9knprddodfokr/avatar/110.jpg\"" />\n                <div class=\""corner corner-top-left\""></div>\n        <div class=\""corner corner-top-right\""></div>\n        <div class=\""corner corner-bottom-left\""></div>\n        <div class=\""corner corner-bottom-right\""></div>\n\t\t\t</span>\n\t\t\t<span class=\""right\"">\n        \t\t\t\t<span class=\""abs-overlay trans-03s roles\"">\n          \t\t\t\t\t<span class=\""title\"">Roles</span>\n\t\t\t\t\t<ul class=\""rolelist\"">\n\t\t\t\t\t\t\t\t\t\t\t\t<li class=\""role\"">Etat-major</li>\n\t\t\t\t\t\t\t\t\t\t\t\t<li class=\""role\"">Membre du Conseil</li>\n\t\t\t\t\t\t\t\t\t\t\t\t<li class=\""role\"">Pilote en service</li>\n\t\t\t\t\t\t\t\t\t\t\t</ul>\n          \t\t\t\t</span>\n                \n                                                \n\t\t\t\t<span class=\""trans-03s frontinfo\"">\n\t\t\t\t\t<span class=\""name-wrap\"">\n\t\t\t\t\t\t<span class=\""trans-03s name data5\"">Maarkreidi</span>\n\t\t\t\t\t\t<span class=\""trans-03s nick data3\"">Maark</span>\n            <div class=\""wrap-border-line left\""></div>\n            <div class=\""wrap-border-line right\""></div>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class=\""ranking-stars data2\"">\n            \t\t\t\t\t\t<span class=\""stars\"" style=\""width: 100%;\""></span>\n            \t\t\t\t\t</span>\n\t\t\t\t\t          <span class=\""rank\"">Commandant de corps</span>\n          \t\t\t\t\t\t\t\t\t</span>\n\t\t\t</span>\n\t\t</a>\n    \t\t    <div class=\""corner corner-top-left\""></div>\n    <div class=\""corner corner-top-right\""></div>\n    <div class=\""corner corner-bottom-left\""></div>\n    <div class=\""corner corner-bottom-right\""></div>\n\t</li>\n\t<li class=\""member-item js-member-item org-main org-visibility-V\"" data-org-sid=\""SWISS\"" data-org-name=\""Swiss Starships\"">\n\t\t<a class=\""membercard js-edit-member\""  href=\""/citizens/Mr_Pandalf\"">\n      <span class=\""thumb\"">\n        \t\t\t\t<img src=\""/media/do3enb8nqt5u2r/avatar/W_0.png\"" />\n                <div class=\""corner corner-top-left\""></div>\n        <div class=\""corner corner-top-right\""></div>\n        <div class=\""corner corner-bottom-left\""></div>\n        <div class=\""corner corner-bottom-right\""></div>\n\t\t\t</span>\n\t\t\t<span class=\""right\"">\n        \t\t\t\t<span class=\""abs-overlay trans-03s roles\"">\n          \t\t\t\t\t<span class=\""title\"">Roles</span>\n\t\t\t\t\t<ul class=\""rolelist\"">\n\t\t\t\t\t\t\t\t\t\t\t</ul>\n          \t\t\t\t</span>\n                \n                                                \n\t\t\t\t<span class=\""trans-03s frontinfo\"">\n\t\t\t\t\t<span class=\""name-wrap\"">\n\t\t\t\t\t\t<span class=\""trans-03s name data5\"">Mr_Pandalf</span>\n\t\t\t\t\t\t<span class=\""trans-03s nick data2\"">Mr_Pandalf</span>\n            <div class=\""wrap-border-line left\""></div>\n            <div class=\""wrap-border-line right\""></div>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class=\""ranking-stars data5\"">\n            \t\t\t\t\t\t<span class=\""stars\"" style=\""width: 40%;\""></span>\n            \t\t\t\t\t</span>\n\t\t\t\t\t          <span class=\""rank\"">Recrue</span>\n          \t\t\t\t\t\t\t\t\t</span>\n\t\t\t</span>\n\t\t</a>\n    \t\t    <div class=\""corner corner-top-left\""></div>\n    <div class=\""corner corner-top-right\""></div>\n    <div class=\""corner corner-bottom-left\""></div>\n    <div class=\""corner corner-bottom-right\""></div>\n\t</li>\n\t<li class=\""member-item js-member-item org-main org-visibility-V\"" data-org-sid=\""SWISS\"" data-org-name=\""Swiss Starships\"">\n\t\t<a class=\""membercard js-edit-member\""  href=\""/citizens/meetsch\"">\n      <span class=\""thumb\"">\n        \t\t\t\t<img src=\""/media/80d4lybcin5dhr/avatar/Swiss-Starships-Ecusson.png\"" />\n                <div class=\""corner corner-top-left\""></div>\n        <div class=\""corner corner-top-right\""></div>\n        <div class=\""corner corner-bottom-left\""></div>\n        <div class=\""corner corner-bottom-right\""></div>\n\t\t\t</span>\n\t\t\t<span class=\""right\"">\n        \t\t\t\t<span class=\""abs-overlay trans-03s roles\"">\n          \t\t\t\t\t<span class=\""title\"">Roles</span>\n\t\t\t\t\t<ul class=\""rolelist\"">\n\t\t\t\t\t\t\t\t\t\t\t</ul>\n          \t\t\t\t</span>\n                \n                                                \n\t\t\t\t<span class=\""trans-03s frontinfo\"">\n\t\t\t\t\t<span class=\""name-wrap\"">\n\t\t\t\t\t\t<span class=\""trans-03s name data3\"">Meetsch</span>\n\t\t\t\t\t\t<span class=\""trans-03s nick data1\"">meetsch</span>\n            <div class=\""wrap-border-line left\""></div>\n            <div class=\""wrap-border-line right\""></div>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class=\""ranking-stars data1\"">\n            \t\t\t\t\t\t<span class=\""stars\"" style=\""width: 40%;\""></span>\n            \t\t\t\t\t</span>\n\t\t\t\t\t          <span class=\""rank\"">Recrue</span>\n          \t\t\t\t\t\t\t\t\t</span>\n\t\t\t</span>\n\t\t</a>\n    \t\t    <div class=\""corner corner-top-left\""></div>\n    <div class=\""corner corner-top-right\""></div>\n    <div class=\""corner corner-bottom-left\""></div>\n    <div class=\""corner corner-bottom-right\""></div>\n\t</li>\n\t<li class=\""member-item js-member-item org-main org-visibility-V\"" data-org-sid=\""SWISS\"" data-org-name=\""Swiss Starships\"">\n\t\t<a class=\""membercard js-edit-member\""  href=\""/citizens/Mi_K_L\"">\n      <span class=\""thumb\"">\n        \t\t\t\t<img src=\""/media/ivofafg2foiz6r/avatar/Rambo-Seals.png\"" />\n                <div class=\""corner corner-top-left\""></div>\n        <div class=\""corner corner-top-right\""></div>\n        <div class=\""corner corner-bottom-left\""></div>\n        <div class=\""corner corner-bottom-right\""></div>\n\t\t\t</span>\n\t\t\t<span class=\""right\"">\n        \t\t\t\t<span class=\""abs-overlay trans-03s roles\"">\n          \t\t\t\t\t<span class=\""title\"">Roles</span>\n\t\t\t\t\t<ul class=\""rolelist\"">\n\t\t\t\t\t\t\t\t\t\t\t</ul>\n          \t\t\t\t</span>\n                \n                                                \n\t\t\t\t<span class=\""trans-03s frontinfo\"">\n\t\t\t\t\t<span class=\""name-wrap\"">\n\t\t\t\t\t\t<span class=\""trans-03s name data4\"">Mickael</span>\n\t\t\t\t\t\t<span class=\""trans-03s nick data4\"">Mi_K_L</span>\n            <div class=\""wrap-border-line left\""></div>\n            <div class=\""wrap-border-line right\""></div>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class=\""ranking-stars data2\"">\n            \t\t\t\t\t\t<span class=\""stars\"" style=\""width: 20%;\""></span>\n            \t\t\t\t\t</span>\n\t\t\t\t\t          <span class=\""rank\"">R&eacute;serviste</span>\n          \t\t\t\t\t\t\t\t\t</span>\n\t\t\t</span>\n\t\t</a>\n    \t\t    <div class=\""corner corner-top-left\""></div>\n    <div class=\""corner corner-top-right\""></div>\n    <div class=\""corner corner-bottom-left\""></div>\n    <div class=\""corner corner-bottom-right\""></div>\n\t</li>\n\t<li class=\""member-item js-member-item org-main org-visibility-V\"" data-org-sid=\""SWISS\"" data-org-name=\""Swiss Starships\"">\n\t\t<a class=\""membercard js-edit-member\""  href=\""/citizens/Rogor_Roxor\"">\n      <span class=\""thumb\"">\n        \t\t\t\t<img src=\""/rsi/static/images/account/avatar_default_big.jpg\"" />\n                <div class=\""corner corner-top-left\""></div>\n        <div class=\""corner corner-top-right\""></div>\n        <div class=\""corner corner-bottom-left\""></div>\n        <div class=\""corner corner-bottom-right\""></div>\n\t\t\t</span>\n\t\t\t<span class=\""right\"">\n        \t\t\t\t<span class=\""abs-overlay trans-03s roles\"">\n          \t\t\t\t\t<span class=\""title\"">Roles</span>\n\t\t\t\t\t<ul class=\""rolelist\"">\n\t\t\t\t\t\t\t\t\t\t\t</ul>\n          \t\t\t\t</span>\n                \n                                                \n\t\t\t\t<span class=\""trans-03s frontinfo\"">\n\t\t\t\t\t<span class=\""name-wrap\"">\n\t\t\t\t\t\t<span class=\""trans-03s name data5\"">Mike_LaMenace</span>\n\t\t\t\t\t\t<span class=\""trans-03s nick data3\"">Rogor_Roxor</span>\n            <div class=\""wrap-border-line left\""></div>\n            <div class=\""wrap-border-line right\""></div>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class=\""ranking-stars data3\"">\n            \t\t\t\t\t\t<span class=\""stars\"" style=\""width: 20%;\""></span>\n            \t\t\t\t\t</span>\n\t\t\t\t\t          <span class=\""rank\"">R&eacute;serviste</span>\n          \t\t\t\t\t\t\t\t\t</span>\n\t\t\t</span>\n\t\t</a>\n    \t\t    <div class=\""corner corner-top-left\""></div>\n    <div class=\""corner corner-top-right\""></div>\n    <div class=\""corner corner-bottom-left\""></div>\n    <div class=\""corner corner-bottom-right\""></div>\n\t</li>\n\t<li class=\""member-item js-member-item org-main org-visibility-V\"" data-org-sid=\""SWISS\"" data-org-name=\""Swiss Starships\"">\n\t\t<a class=\""membercard js-edit-member\""  href=\""/citizens/Major_Duke\"">\n      <span class=\""thumb\"">\n        \t\t\t\t<img src=\""/media/jcxp1bk3lu52yr/avatar/Horror-Reptile.jpg\"" />\n                <div class=\""corner corner-top-left\""></div>\n        <div class=\""corner corner-top-right\""></div>\n        <div class=\""corner corner-bottom-left\""></div>\n        <div class=\""corner corner-bottom-right\""></div>\n\t\t\t</span>\n\t\t\t<span class=\""right\"">\n        \t\t\t\t<span class=\""abs-overlay trans-03s roles\"">\n          \t\t\t\t\t<span class=\""title\"">Roles</span>\n\t\t\t\t\t<ul class=\""rolelist\"">\n\t\t\t\t\t\t\t\t\t\t\t</ul>\n          \t\t\t\t</span>\n                \n                                                \n\t\t\t\t<span class=\""trans-03s frontinfo\"">\n\t\t\t\t\t<span class=\""name-wrap\"">\n\t\t\t\t\t\t<span class=\""trans-03s name data2\"">Major Duke</span>\n\t\t\t\t\t\t<span class=\""trans-03s nick data2\"">Major_Duke</span>\n            <div class=\""wrap-border-line left\""></div>\n            <div class=\""wrap-border-line right\""></div>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class=\""ranking-stars data3\"">\n            \t\t\t\t\t\t<span class=\""stars\"" style=\""width: 40%;\""></span>\n            \t\t\t\t\t</span>\n\t\t\t\t\t          <span class=\""rank\"">Recrue</span>\n          \t\t\t\t\t\t\t\t\t</span>\n\t\t\t</span>\n\t\t</a>\n    \t\t    <div class=\""corner corner-top-left\""></div>\n    <div class=\""corner corner-top-right\""></div>\n    <div class=\""corner corner-bottom-left\""></div>\n    <div class=\""corner corner-bottom-right\""></div>\n\t</li>\n\t<li class=\""member-item js-member-item org-main org-visibility-V\"" data-org-sid=\""SWISS\"" data-org-name=\""Swiss Starships\"">\n\t\t<a class=\""membercard js-edit-member\""  href=\""/citizens/Olderan\"">\n      <span class=\""thumb\"">\n        \t\t\t\t<img src=\""/media/y15plz8yysn3cr/avatar/Blackeyegalaxy.jpg\"" />\n                <div class=\""corner corner-top-left\""></div>\n        <div class=\""corner corner-top-right\""></div>\n        <div class=\""corner corner-bottom-left\""></div>\n        <div class=\""corner corner-bottom-right\""></div>\n\t\t\t</span>\n\t\t\t<span class=\""right\"">\n        \t\t\t\t<span class=\""abs-overlay trans-03s roles\"">\n          \t\t\t\t\t<span class=\""title\"">Roles</span>\n\t\t\t\t\t<ul class=\""rolelist\"">\n\t\t\t\t\t\t\t\t\t\t\t</ul>\n          \t\t\t\t</span>\n                \n                                                \n\t\t\t\t<span class=\""trans-03s frontinfo\"">\n\t\t\t\t\t<span class=\""name-wrap\"">\n\t\t\t\t\t\t<span class=\""trans-03s name data1\"">Merlin</span>\n\t\t\t\t\t\t<span class=\""trans-03s nick data1\"">Olderan</span>\n            <div class=\""wrap-border-line left\""></div>\n            <div class=\""wrap-border-line right\""></div>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class=\""ranking-stars data3\"">\n            \t\t\t\t\t\t<span class=\""stars\"" style=\""width: 20%;\""></span>\n            \t\t\t\t\t</span>\n\t\t\t\t\t          <span class=\""rank\"">R&eacute;serviste</span>\n          \t\t\t\t\t\t\t\t\t</span>\n\t\t\t</span>\n\t\t</a>\n    \t\t    <div class=\""corner corner-top-left\""></div>\n    <div class=\""corner corner-top-right\""></div>\n    <div class=\""corner corner-bottom-left\""></div>\n    <div class=\""corner corner-bottom-right\""></div>\n\t</li>\n\t<li class=\""member-item js-member-item org-main org-visibility-V\"" data-org-sid=\""SWISS\"" data-org-name=\""Swiss Starships\"">\n\t\t<a class=\""membercard js-edit-member\""  href=\""/citizens/Mike_Roxor\"">\n      <span class=\""thumb\"">\n        \t\t\t\t<img src=\""/media/zzw94vxbss2w9r/avatar/Swissmade.jpg\"" />\n                <div class=\""corner corner-top-left\""></div>\n        <div class=\""corner corner-top-right\""></div>\n        <div class=\""corner corner-bottom-left\""></div>\n        <div class=\""corner corner-bottom-right\""></div>\n\t\t\t</span>\n\t\t\t<span class=\""right\"">\n        \t\t\t\t<span class=\""abs-overlay trans-03s roles\"">\n          \t\t\t\t\t<span class=\""title\"">Roles</span>\n\t\t\t\t\t<ul class=\""rolelist\"">\n\t\t\t\t\t\t\t\t\t\t\t</ul>\n          \t\t\t\t</span>\n                \n                                                \n\t\t\t\t<span class=\""trans-03s frontinfo\"">\n\t\t\t\t\t<span class=\""name-wrap\"">\n\t\t\t\t\t\t<span class=\""trans-03s name data1\"">Mike Swissmade</span>\n\t\t\t\t\t\t<span class=\""trans-03s nick data2\"">Mike_Roxor</span>\n            <div class=\""wrap-border-line left\""></div>\n            <div class=\""wrap-border-line right\""></div>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class=\""ranking-stars data3\"">\n            \t\t\t\t\t\t<span class=\""stars\"" style=\""width: 20%;\""></span>\n            \t\t\t\t\t</span>\n\t\t\t\t\t          <span class=\""rank\"">R&eacute;serviste</span>\n          \t\t\t\t\t\t\t\t\t</span>\n\t\t\t</span>\n\t\t</a>\n    \t\t    <div class=\""corner corner-top-left\""></div>\n    <div class=\""corner corner-top-right\""></div>\n    <div class=\""corner corner-bottom-left\""></div>\n    <div class=\""corner corner-bottom-right\""></div>\n\t</li>\n\t<li class=\""member-item js-member-item org-main org-visibility-V\"" data-org-sid=\""SWISS\"" data-org-name=\""Swiss Starships\"">\n\t\t<a class=\""membercard js-edit-member\""  href=\""/citizens/Genju\"">\n      <span class=\""thumb\"">\n        \t\t\t\t<img src=\""/media/ukk48x1o0xgmyr/avatar/1080.png\"" />\n                <div class=\""corner corner-top-left\""></div>\n        <div class=\""corner corner-top-right\""></div>\n        <div class=\""corner corner-bottom-left\""></div>\n        <div class=\""corner corner-bottom-right\""></div>\n\t\t\t</span>\n\t\t\t<span class=\""right\"">\n        \t\t\t\t<span class=\""abs-overlay trans-03s roles\"">\n          \t\t\t\t\t<span class=\""title\"">Roles</span>\n\t\t\t\t\t<ul class=\""rolelist\"">\n\t\t\t\t\t\t\t\t\t\t\t</ul>\n          \t\t\t\t</span>\n                \n                                                \n\t\t\t\t<span class=\""trans-03s frontinfo\"">\n\t\t\t\t\t<span class=\""name-wrap\"">\n\t\t\t\t\t\t<span class=\""trans-03s name data1\"">Mute</span>\n\t\t\t\t\t\t<span class=\""trans-03s nick data5\"">Genju</span>\n            <div class=\""wrap-border-line left\""></div>\n            <div class=\""wrap-border-line right\""></div>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class=\""ranking-stars data3\"">\n            \t\t\t\t\t\t<span class=\""stars\"" style=\""width: 20%;\""></span>\n            \t\t\t\t\t</span>\n\t\t\t\t\t          <span class=\""rank\"">R&eacute;serviste</span>\n          \t\t\t\t\t\t\t\t\t</span>\n\t\t\t</span>\n\t\t</a>\n    \t\t    <div class=\""corner corner-top-left\""></div>\n    <div class=\""corner corner-top-right\""></div>\n    <div class=\""corner corner-bottom-left\""></div>\n    <div class=\""corner corner-bottom-right\""></div>\n\t</li>\n"
            }
        };

        private Mock<IRestClient> _mockRest = new Mock<IRestClient>();
    }
}